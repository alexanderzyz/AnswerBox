# 计算机组成原理扩展指令

**仅供参考，严禁抄袭**

## 代码说明

code中src文件夹中存储的是所有的src文件(design)

code中sim文件夹中，_tb文件是激励文件(simulation)

inst.data文件是测试用的十六进制文件（按照教程中放入指定位置即可）

## 扩展指令

扩展的指令为jr和jal

实现jr指令的思路：

首先分析jr代码属于R型指令，op段为000000，实现的功能为将rs寄存器中存储的内容转移给pc，而IFU中并不存在对jr指令的单独处理，因此我选择增加一个指令ct_jr作为controller的输出来判断是否为jr指令并且将此指令输入IFU中。

在controller中分析ct_jr指令，需要由op位和funct位同时决定，可以得出inst_jr的值，ct_jr的值则等于inst_jr的值。但应该同时注意到，由于jr不是单独的op指令，而jr是属于r型指令的，但是r型指令的操作：向rd中写入经过处理的rs和rt的数据并不存在，因此jr并不能与其他r型指令执行同样的操作，因此要单独处理一些信号例如：ct_rf_wen，让寄存器的写使能信号在inst_jr为1时为0

ALU中的操作是令rs和rt这两个寄存器的内容相加，由于0号寄存器的内容始终是0，因此相当于ALU_res=(rs)，但是由于ALU_res的计算结果在前面的设计中无法传入到IFU中，因此要在IFU中添加ALU_res，则判断ct_jr成立时，让pc跳到ALU_res，即完成了实现jr指令，

​          总结，数据通路增加了controller到IFU的 wire类型 ct_jr，添加了ALU到IFU的wire[31:0]类型的ALU_res

 

​     实现jal指令的思路：

首先分析jal输入j型指令，拥有单独的op为000011，实现的功能是将pc+4的值存入31号寄存器中并且pc转移到后面传入的地址处，同样IFU中不存在对jr指令得到单独处理，因此我选择在controller中增加一个ct_jr的指令，并且将指令输入到Regfile中单独对第31号寄存器做处理，输入到IFU中单独对pc做处理。

对于regfile来讲，正常是根据信号判断自己要是写或是读，而此时是要对31号寄存器进行写操作，所以要在controller中让ct_rf_wen为1，并且判断此时的ct_jr是否为1，为1则将31号寄存器的内容写入pc+4，但是由于regfile中并不存在pc，因此再加入输入pc,IFU中加入输出pc，这样就完成了将pc+4存入第31号寄存器的工作，此时IFU中跳到后面传入的地址的操作与j指令的操作相同，因此令controller中的ct_j等于1即可，这样就完成了jal指令。

总结，数据通路增加了controller到RegFile的wire类型ct_jal，增加了IFU到 RegFile的reg[31:0]类型的pc

## 实验数据

jr指令：（按汇编语言、二进制代码、16进制代码的格式）

 

addiu $2 $0 8

001001 00000 00010 0000 0000 0000 1000

24020008

 

addiu $3 $0 3

001001 00000 00011 0000 0000 0000 0011

24030003

 

addiu $1 $1 1

001001 00001 00001 0000 0000 0000 0001

24210001

 

 

beq $3 $1 1 

000100 00001 00011 0000 0000 0000 0001

10230001

 

jr $2

000000 00010 00000 00000 00000 001000

00400008

 

addiu $4 $0 666

001001 00000 00100 0000 0110 0110 0110

24040666



jal指令：（按汇编语言、二进制代码、16进制代码的格式）

​    

addiu $3 $0 3

001001 00000 00011 0000 0000 0000 0011

24030003

 

addiu $1 $1 1

001001 00001 00001 0000 0000 0000 0001

24210001

 

 

 

beq $3 $1 1

000100 00001 00011 0000 0000 0000 0001

10230001

 

jal 1 

000011 000000 0000 0000 0000 0000 0100

0C000001

 

addiu $4 $0 666

001001 00000 00100 0000 0110 0110 0110

24040666

 

addiu $31 $31 0

001001 11111 11111 0000 0000 0000 0000

27FF0000